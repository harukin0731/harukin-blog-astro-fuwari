---
title: VSCodeをWaylandのHiDPI環境で動かす根本的でない解決方法
published: 2024-09-05
tags: [Web, VSCode]
category: development
draft: false
---

# 結論

1. VSCodeはバックだけで起動させるべし
   ```shell
   code serve-web
   ```
2. Chromeもwaylandサポートを有効化させて起動させるべし
   ```shell
   google-chrome --ozone-platform=wayland --gtk-version=4
   ```
3. 1で出てきたアドレスにChromeからアクセスしてPWAを保存する

![](./Screenshot%20from%202024-09-05%2013-37-23.png)
こんな感じで、175%の環境でもぼやけることなく表示でき、なおかつ日本語入力も可能だ。

# WaylandとChrome系の現状

Mastodonで「ChromeがWaylandでぼやけてるからFirefox系使ってる」という話を見たのでちょっと検証をしてみた。

現状もまだ、WaylandとChromeはいまいち相性が悪いようで、検証環境でもChromeが動かないわけではないもののどうもぼやけてる。

ただChrome系もだいぶマシになってきているようで、上記の2つのオプションをつけてコマンドで起動させればちゃんと日本語も入力できてぼやけないChromeが動いた。

VSCodeも中身はElectronだからChrome系だし、同じオプションを使えるはずなのだが、wayland指定はできてもgtk-versionは受け付けない。なぜだろうか。gtk-versionが受け付けないと、ボヤけないものの日本語が入力できない。

というわけで苦肉の策（？）で思いついたのが冒頭のこれ。フロントエンドはただのブラウザだから自由にしてしまえばいいんだよ、と思いついたのでVSCodeをフロントなしで起動させて、ブラウザからアクセスするようにした。

![](./Screenshot%20from%202024-09-05%2013-35-04.png)
頭では理解していても認識を拒否してくるなこれ。一応これでもただのChromeの画面なのだから...

## 注意点
この環境、どうやらリモートアクセス関係の機能が結構塞がれてしまう（そりゃそうだよな、内部でアドレス変更してアクセスしてたしな）ので、そのアクセス先毎にPWA生やすでもヨシ。あくまでも、どこかにアクセスするためのベースとしては機能しない、現在の表にあるマシンの環境そのものにアクセスするということだけ認識できればいいと思う。それ以外は割と普通に拡張機能とかも入ったし、普通にCodeが動いて面白いと思った。


